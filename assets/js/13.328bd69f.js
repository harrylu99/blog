(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{585:function(t,e,s){t.exports=s.p+"assets/img/concept1.f62f7008.png"},586:function(t,e,s){t.exports=s.p+"assets/img/concept2.2f53c0c7.png"},648:function(t,e,s){"use strict";s.r(e);var a=s(17),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"concept-of-react"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#concept-of-react"}},[t._v("#")]),t._v(" Concept of React")]),t._v(" "),a("p",[t._v("Let's see how "),a("code",[t._v("React")]),t._v(" team describe their product.")]),t._v(" "),a("blockquote",[a("p",[t._v("React is, in our opinion, the premier way to build big, fast Web apps with JavaScript. It has scaled very well for us at Facebook and Instagram.")])]),t._v(" "),a("p",[t._v("You might found that they use the word "),a("code",[t._v("fast")]),t._v(" to describe "),a("code",[t._v("React")]),t._v(". So, we could start from disscuss the factor that might affect the speed of response. In our daily life, there are two scenarios might affect the response speed, which includes")]),t._v(" "),a("ul",[a("li",[t._v("When encountering large computation operations or insufficient performance of the device, the FPS frops, result in stutters.")]),t._v(" "),a("li",[t._v("After sending internet request, it might take while for get response so that cannot response fast.")])]),t._v(" "),a("p",[t._v("And we could summary these two as")]),t._v(" "),a("ul",[a("li",[t._v("Bottleneck of CPU")]),t._v(" "),a("li",[t._v("Bottleneck of IO")])]),t._v(" "),a("p",[t._v("How does "),a("code",[t._v("React")]),t._v(" handle these problems?")]),t._v(" "),a("h2",{attrs:{id:"bottleneck-of-cpu"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bottleneck-of-cpu"}},[t._v("#")]),t._v(" Bottleneck of CPU")]),t._v(" "),a("p",[t._v("It is very easy to meet the bottleneck of CPU when the project is huge and has a lot of components.")]),t._v(" "),a("p",[t._v("Think about the example when we are going to render 3000 "),a("code",[t._v("li")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" len "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("ul"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("len"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fill")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("li"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("li"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ul"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" rootEl "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("querySelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#root"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nReactDOM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("App "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rootEl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("Most browsers have 60Hz screen refresh rate, which means the browser refresh every 16.6ms (1000ms / 60Hz).")]),t._v(" "),a("p",[t._v("As we known, JS could manipulate the DOM and the "),a("code",[t._v("thread of GUI rendering")]),t._v(" is mutually exclusive with the "),a("code",[t._v("thread of JS")]),t._v(". So that the JS script, browser layout and render cannot execute synchronously.")]),t._v(" "),a("p",[t._v("Which means these work needs to be done in 16.6ms")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("JS script --\x3e layout --\x3e render\n")])])]),a("p",[t._v("If the runtime of JS needs more than 16.6ms, which means there is not time left for the layout and render.")]),t._v(" "),a("p",[t._v("From the example above, the script might needs more time for JS execution based on the amount of the components. From the following pic, we could find out that the runtime of the JS is 73.65ms from the execution stack, which is much more than a FPS, it causes the FPS drops and page stutter.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(585),alt:"execution stack of js"}})]),t._v(" "),a("p",[t._v("Can we solve this problem? The answer is yes, and "),a("code",[t._v("React")]),t._v(" has already solve this for us.")]),t._v(" "),a("p",[a("code",[t._v("React")]),t._v(" leave some space for JS thread in each FPS and use the time for update the component. You can "),a("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/scheduler/src/forks/SchedulerHostConfig.default.js#L119",target:"_blank",rel:"noopener noreferrer"}},[t._v("check here"),a("OutboundLink")],1),t._v(" to find out that React leave 5ms for JS thread in default.")]),t._v(" "),a("p",[t._v("When the time is not enough for the script, "),a("code",[t._v("React")]),t._v(" will give the control back to browser for it to render UI. The rest of script will be execute in the next FPS. And we named it as "),a("code",[t._v("time slice")]),t._v(".")]),t._v(" "),a("p",[t._v("Next, turn on the "),a("code",[t._v("Concurrent Mode")]),t._v("(we will talk about it in later chapter, you just need to know the "),a("code",[t._v("time slice")]),t._v(" will be apply after it have been turned on).")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// turn on Concurrent Mode")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ReactDOM.render(<App/>, rootEl);")]),t._v("\nReactDOM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unstable_createRoot")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rootEl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("App "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("And now, you could see that our one task has been sliced into separately FPS task and normally it takes about 5ms. As we talked before, now the browser has enough time for layout and render.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(586),alt:"execution stack of js 2"}})]),t._v(" "),a("p",[t._v("Therefore, the key to optimize the "),a("code",[t._v("neckbottle of CPU")]),t._v(" is implement the "),a("code",[t._v("time slice")]),t._v(". And the "),a("code",[t._v("time slice")]),t._v(" is switch the "),a("code",[t._v("synchronous update")]),t._v(" to the "),a("code",[t._v("asynchronous update")]),t._v(" which could be "),a("code",[t._v("paused")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"bottleneck-of-io"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bottleneck-of-io"}},[t._v("#")]),t._v(" Bottleneck of IO")]),t._v(" "),a("p",[t._v("Network latency is something we cannot slove as a frontend developer. What we can do, is trying to reduce the user awareness of the network latency. "),a("code",[t._v("React")]),t._v(" suggests that "),a("a",{attrs:{href:"https://reactjs.org/docs/concurrent-mode-intro.html#putting-research-into-production",target:"_blank",rel:"noopener noreferrer"}},[t._v("integrate the findings from the Human-Computer Interaction research into real UIs"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("p",[t._v("This suggestion might seems abstract. If you are using IPhone, you could try it with your phone.")]),t._v(" "),a("p",[t._v("Open the Settings and find the General and Siri & Search, click both of them and compare the difference between these two. You might feel the same when you click them. But in fact, when you click the Siri & Rearch button, the Settings page still stay in the front for a while, and system did a network requst during this time, which you can actually feel it if you are in a slow connection enviroment.")]),t._v(" "),a("p",[a("code",[t._v("React")]),t._v(" provides "),a("a",{attrs:{href:"https://reactjs.org/docs/concurrent-mode-suspense.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Suspense"),a("OutboundLink")],1),t._v(" and the hook "),a("a",{attrs:{href:"https://reactjs.org/docs/concurrent-mode-reference.html#usedeferredvalue",target:"_blank",rel:"noopener noreferrer"}},[t._v("useDeferredValue"),a("OutboundLink")],1),t._v(" for improve the ux.")]),t._v(" "),a("p",[t._v("For supporting these features, "),a("code",[t._v("React")]),t._v(" also require for change the synchronous update to the asynchronous update which could be paused.")]),t._v(" "),a("h2",{attrs:{id:"summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("We have talked about how "),a("code",[t._v("React")]),t._v(" try to provide a tool for us to build a big and fast response Web app, and we could say that the key for implement the concept, is switching the "),a("code",[t._v("synchronous update")]),t._v(" to the "),a("code",[t._v("asynchronous update")]),t._v(" which could be "),a("code",[t._v("paused")]),t._v(".")])])}),[],!1,null,null,null);e.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{651:function(e,t,r){"use strict";r.r(t);var a=r(17),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h2",{attrs:{id:"foreword"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#foreword"}},[e._v("#")]),e._v(" Foreword")]),e._v(" "),r("p",[e._v("We are going to talk about how does "),r("code",[e._v("React")]),e._v(" support asynchronous updates in React 16.")]),e._v(" "),r("h2",{attrs:{id:"architecture"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#architecture"}},[e._v("#")]),e._v(" Architecture")]),e._v(" "),r("p",[e._v("There are three layers in "),r("code",[e._v("React16")]),e._v(", which are")]),e._v(" "),r("ul",[r("li",[r("code",[e._v("Scheduler")]),e._v(" -- In charge for rank the priority of the tasks. Make sure the task with high priority would enter "),r("code",[e._v("Reconciler")]),e._v(" first.")]),e._v(" "),r("li",[r("code",[e._v("Reconciler")]),e._v(" -- Find the modified components.")]),e._v(" "),r("li",[r("code",[e._v("Renderer")]),e._v(" -- Render the modified components to the page.")])]),e._v(" "),r("p",[e._v("You might find out that React16 has the brand new Scheduler compare with React15.")]),e._v(" "),r("h3",{attrs:{id:"scheduler"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#scheduler"}},[e._v("#")]),e._v(" Scheduler")]),e._v(" "),r("p",[e._v("As we talked in the previous article concept, we know that "),r("code",[e._v("React")]),e._v(" use the remaining time of the browser to judge if the update finish or need to be paused. Therefore, we need the browser tell us if they still got time.")]),e._v(" "),r("p",[e._v("In fact, some browser have "),r("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback",target:"_blank",rel:"noopener noreferrer"}},[e._v("requestIdleCallback"),r("OutboundLink")],1),e._v(" for implement the requriment. However, React did not choose to use it, because")]),e._v(" "),r("ul",[r("li",[e._v("Browser Compatibility.")]),e._v(" "),r("li",[e._v("Trigger event is not stable. For example, the frequency of requestIdleCallback for triggering the former tab will decrease after we switch the tab in the browser.")])]),e._v(" "),r("p",[e._v("Based on that, "),r("code",[e._v("React")]),e._v(" has a more functional "),r("code",[e._v("requestIdleCallback")]),e._v(" polyfill, which is "),r("code",[e._v("Scheduler")]),e._v(". "),r("code",[e._v("Scheduler")]),e._v(" also provides mutiple settings for set the priority of the tasks.")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://github.com/facebook/react/tree/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/scheduler",target:"_blank",rel:"noopener noreferrer"}},[e._v("Scheduler is an independce package of React"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"reconciler"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#reconciler"}},[e._v("#")]),e._v(" Reconciler")]),e._v(" "),r("p",[r("code",[e._v("Reconciler")]),e._v(" update the virtual DOM recursively in React 15. "),r("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiberWorkLoop.new.js#L1673",target:"_blank",rel:"noopener noreferrer"}},[e._v("Check it in React16"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("We could know that the updating have changed to be pasued friendly based on the source code. And each loop will call "),r("code",[e._v("shouldYield")]),e._v(" for checking the remaining time.")]),e._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/** @noinline */")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("workLoopConcurrent")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Perform work until Scheduler asks us to yield")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("while")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("workInProgress "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!==")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("null")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("shouldYield")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    workInProgress "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[e._v("performUnitOfWork")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("workInProgress"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),r("p",[e._v("And how React16 handle the problem when we pause the updating?")]),e._v(" "),r("p",[e._v("The answer is, in "),r("code",[e._v("React16")]),e._v(", "),r("code",[e._v("Reconciler")]),e._v(" will give a "),r("code",[e._v("tag")]),e._v(" to the changed DOM after "),r("code",[e._v("Scheduler")]),e._v(" handle the tasks to "),r("code",[e._v("Reconciler")]),e._v(".")]),e._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" Placement "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/*             */")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[e._v("0b0000000000010")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" Update "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/*                */")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[e._v("0b0000000000100")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" PlacementAndUpdate "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/*    */")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[e._v("0b0000000000110")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" Deletion "),r("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[e._v("/*              */")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[e._v("0b0000000001000")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),r("p",[r("a",{attrs:{href:"https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactSideEffectTags.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("You can find the file here"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("The whole process of "),r("code",[e._v("Scheduler")]),e._v(" and "),r("code",[e._v("Reconciler")]),e._v(" are processing in the "),r("code",[e._v("Memory")]),e._v(", "),r("code",[e._v("Renderer")]),e._v(" will receive them when the whole process is done.")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://reactjs.org/docs/codebase-overview.html#fiber-reconciler",target:"_blank",rel:"noopener noreferrer"}},[e._v("How React team explain the new Reconciler"),r("OutboundLink")],1)]),e._v(" "),r("h3",{attrs:{id:"renderer"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#renderer"}},[e._v("#")]),e._v(" Renderer")]),e._v(" "),r("p",[r("code",[e._v("Renderer")]),e._v(" will do what they required to do, based on the tag with "),r("code",[e._v("virtual DOM")]),e._v(" from "),r("code",[e._v("Reconciler")]),e._v(".")]),e._v(" "),r("p",[e._v("As the result, if you pause the updating in the React16, it will not show you the incomplete updates based on the "),r("code",[e._v("Scheduler")]),e._v(" and the new "),r("code",[e._v("Reconciler")]),e._v(".")]),e._v(" "),r("h2",{attrs:{id:"conclusion"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),r("p",[e._v("From this article, we know that "),r("code",[e._v("React16")]),e._v(" is using the new "),r("code",[e._v("Reconciler")]),e._v(" which is "),r("code",[e._v("Fiber")]),e._v(" architecture.")]),e._v(" "),r("p",[e._v("We will talk about what is "),r("code",[e._v("Fiber")]),e._v(" and how does it related to "),r("code",[e._v("Reconciler")]),e._v(" or "),r("code",[e._v("React")]),e._v(" in the next.")]),e._v(" "),r("h2",{attrs:{id:"reference"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[e._v("#")]),e._v(" Reference")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://www.youtube.com/watch?v=CGpMlWVcHok&list=PLPxbbTqCLbGHPxZpw4xj_Wwg8-fdNxJRh&index=7",target:"_blank",rel:"noopener noreferrer"}},[e._v("Building a Custom React Renderer | Sophie Alpert"),r("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=s.exports}}]);
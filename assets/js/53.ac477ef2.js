(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{633:function(t,e,s){"use strict";s.r(e);var a=s(17),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"foreword"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#foreword"}},[t._v("#")]),t._v(" Foreword")]),t._v(" "),s("p",[t._v("React core team member "),s("a",{attrs:{href:"https://github.com/sebmarkbage/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Sebastian Markb√•ge"),s("OutboundLink")],1),t._v(" once said: We React what is done in pratice is "),s("code",[t._v("Algebraic Effects")]),t._v(".")]),t._v(" "),s("p",[t._v("So, what is "),s("code",[t._v("Algebraic Effects")]),t._v(" and how does it related with "),s("code",[t._v("React")]),t._v("?")]),t._v(" "),s("h2",{attrs:{id:"algebraic-effects"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#algebraic-effects"}},[t._v("#")]),t._v(" Algebraic Effects")]),t._v(" "),s("p",[s("code",[t._v("Algebraic Effects")]),t._v(" is a concept of the "),s("code",[t._v("functional programming")]),t._v(", it could be used for separating "),s("code",[t._v("side effects")]),t._v(" from the "),s("code",[t._v("functions")]),t._v(".")]),t._v(" "),s("p",[t._v("We are going to use fake syntax for explain it.")]),t._v(" "),s("p",[t._v("Think about if we have a function "),s("code",[t._v("getTotalPicNum")]),t._v(" and after receive two "),s("code",[t._v("user")]),t._v(", it could search for the number of pics in the platform from both users and return a total pic number.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalPicNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" picNum1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPicNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" picNum2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPicNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" picNum1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" picNum2\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("We do not need to focus on the implement of "),s("code",[t._v("getPicNum")]),t._v(" in the above function. What we do care is the process how it return the total of these two numbers.")]),t._v(" "),s("p",[t._v("Next, we trying to implement the "),s("code",[t._v("getPicNum")]),t._v(".")]),t._v(" "),s("p",[t._v("The number of pics is stored in the server so that we need to do an asynchronous request. And I think we could use "),s("code",[t._v("async await")]),t._v(" for handle the request.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalPicNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" picNum1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPicNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" picNum2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPicNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("user2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" picNum1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" picNum2\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("However, the functions which call the "),s("code",[t._v("async")]),t._v(" function should be "),s("code",[t._v("async")]),t._v(" as well, which changed the synchronous of "),s("code",[t._v("getTotalPicNum")]),t._v(".")]),t._v(" "),s("p",[t._v("Any solutions for us to solve this problem? Unfortunally, there is no way for implement asynchronous requests when keep use the current "),s("code",[t._v("getTotalPicNum")]),t._v(".")]),t._v(" "),s("p",[t._v("We will create a fake syntax for solving it. Let's create a syntax that is similar with "),s("code",[t._v("try...catch")]),t._v(". We could named it "),s("code",[t._v("try...handle")]),t._v(" with two opeartors "),s("code",[t._v("perform")]),t._v(" and "),s("code",[t._v("resume")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getPicNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" picNum "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" perform name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" picNum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getTotalPicNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Evan'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'You'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handle")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("who")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("who"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Evan'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      resume "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'You'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      resume "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("240")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      resume "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("When "),s("code",[t._v("getPicNum")]),t._v(" have been called, "),s("code",[t._v("perform name")]),t._v(" would be executed, followed by the function execution stack will pop out from "),s("code",[t._v("getPicNum")]),t._v(" and be catched by the nearest "),s("code",[t._v("try...handle")]),t._v(".")]),t._v(" "),s("p",[s("code",[t._v("Error")]),t._v(" would be the parameter of "),s("code",[t._v("catch")]),t._v(" after "),s("code",[t._v("throw Error")]),t._v(" and "),s("code",[t._v("name")]),t._v(" would be the parameter of "),s("code",[t._v("handle")]),t._v(" after "),s("code",[t._v("perform name")]),t._v(".")]),t._v(" "),s("p",[t._v("After "),s("code",[t._v("Error")]),t._v(" catched by the "),s("code",[t._v("catch")]),t._v(", the previous stack will be destroyed and back to the execution stack of "),s("code",[t._v("perform")]),t._v(" after "),s("code",[t._v("handle")]),t._v(" execute the "),s("code",[t._v("resume")]),t._v(".")]),t._v(" "),s("p",[t._v("For "),s("code",[t._v("case 'Evan'")]),t._v(", the execution stack will back to "),s("code",[t._v("getPicNum")]),t._v(" after executed "),s("code",[t._v("resume with 120")]),t._v(". "),s("code",[t._v("picNum === 120")]),t._v(" in this time.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"},[t._v("Tip")]),s("p",[s("code",[t._v("try...catch")]),t._v(" is a fake syntax for explaining the "),s("code",[t._v("Algebraic Effects")]),t._v(".")])]),s("p",[t._v("To sum up, "),s("code",[t._v("Algebraic Effects")]),t._v(" could separate "),s("code",[t._v("side effects")]),t._v(" which is getting the number of pics in the example from the function logic, help the focus point of the function stay pure. Furthemore, we could see that it does not need to care about synchronous or asynchronous in "),s("code",[t._v("perform resume")]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"algebraic-effects-in-react"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#algebraic-effects-in-react"}},[t._v("#")]),t._v(" Algebraic Effects in React")]),t._v(" "),s("p",[t._v("The most common thing we could find that implement "),s("code",[t._v("Algebraic Effects")]),t._v(" in "),s("code",[t._v("React")]),t._v(" is "),s("code",[t._v("Hooks")]),t._v(".")]),t._v(" "),s("p",[t._v("When we using the "),s("code",[t._v("Hook")]),t._v(" like "),s("code",[t._v("useState")]),t._v(", "),s("code",[t._v("useReducer")]),t._v(" and "),s("code",[t._v("useRef")]),t._v(", we do not need to think about how does the "),s("code",[t._v("state")]),t._v(" of "),s("code",[t._v("FunctionComponent")]),t._v(" saved in "),s("code",[t._v("Hook")]),t._v(" which "),s("code",[t._v("React")]),t._v(" have already implement for us.")]),t._v(" "),s("p",[t._v("We only need to write the business logic when we using "),s("code",[t._v("useState")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("num"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" updateNum"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button onClick"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateNum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("num")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" num "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("num"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("a",{attrs:{href:"https://codesandbox.io/s/frosty-hermann-bztrp?file=/src/index.js:152-160",target:"_blank",rel:"noopener noreferrer"}},[t._v("Check this Suspense Demo from React team"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("code",[t._v("ProfileDetails")]),t._v(" for showing the User's name in the "),s("code",[t._v("Demo")]),t._v(" and User's name is "),s("code",[t._v("asynchronous request")]),t._v(". However, "),s("code",[t._v("Demo")]),t._v(" is synchronous.")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ProfileDetails")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" resource"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("h1"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"algebraic-effects-and-generator"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#algebraic-effects-and-generator"}},[t._v("#")]),t._v(" Algebraic Effects and Generator")]),t._v(" "),s("p",[t._v("One of the purpose of re-building "),s("code",[t._v("Reconciler")]),t._v(" in "),s("code",[t._v("React16")]),t._v(" is to change the synchronous update to the asynchronous update which could be paused.")]),t._v(" "),s("p",[t._v("Which means, the updates could be paused or break from the middle of the tasks and it could keep handling with the previous task after resume.")]),t._v(" "),s("p",[t._v("And that is the effect from the "),s("code",[t._v("Algebraic Effects")]),t._v(".")]),t._v(" "),s("p",[s("code",[t._v("Generator")]),t._v(" is very similar to this and it has been built in the browser. However, "),s("code",[t._v("React")]),t._v(" team gave up for using it based on some disadvantages from the "),s("code",[t._v("Generator")]),t._v(".")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Generators")]),t._v(" does not just let you yield in the middle of a stack. You have to wrap every single function in a "),s("code",[t._v("generator")]),t._v(". This not only adds a lot of syntactic overhead but also runtime overhead in any existing implementation. It's fair that the syntax might be more helpful than not, but the perf issue still stands.")]),t._v(" "),s("li",[t._v("The biggest reason, however, is that "),s("code",[t._v("generators")]),t._v(" are stateful. You can not resume in the middle of it.")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doWork")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("B")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doExpensiveWorkA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doExpensiveWorkB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("B")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" z "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" y "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doExpensiveWorkC")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("C")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" z\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Everytime when the browser has free time, it executes one of the "),s("code",[t._v("doExpensiveWorks")]),t._v(" in turn and will be paused when the time runs out, then resumes from where it left off when it resumes again.")]),t._v(" "),s("p",[t._v("That could be a good case for using "),s("code",[t._v("Generator")]),t._v(" when we only need to consider about one task pause or resume.")]),t._v(" "),s("p",[t._v("Besides, when we thinking about when the high priority task is cutting the line after "),s("code",[t._v("doExpensiveWorkA")]),t._v(" and "),s("code",[t._v("doExpensiveWorkB")]),t._v(" have finished their job. At this moment, component "),s("code",[t._v("B")]),t._v(" has recieve a "),s("code",[t._v("priority update")]),t._v(", however, since the "),s("code",[t._v("generators")]),t._v(" are stateful, the value "),s("code",[t._v("x")]),t._v(" and "),s("code",[t._v("y")]),t._v(" cannot be reuse here, which means it has to be re-caculate.")]),t._v(" "),s("p",[t._v("Based on that, "),s("code",[t._v("React")]),t._v(" did not choose use "),s("code",[t._v("Generator")]),t._v(" for implement the "),s("code",[t._v("Reconciler")]),t._v(".")]),t._v(" "),s("h2",{attrs:{id:"algebraic-effects-and-fiber"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#algebraic-effects-and-fiber"}},[t._v("#")]),t._v(" Algebraic Effects and Fiber")]),t._v(" "),s("p",[s("code",[t._v("Fiber")]),t._v(", as the same as "),s("code",[t._v("Process")]),t._v(", "),s("code",[t._v("Thread")]),t._v(" and "),s("code",[t._v("Coroutine")]),t._v(", it is one of the virtual concepts of the operating system. Most articles think "),s("code",[t._v("Fiber")]),t._v(" is an implementation of the "),s("code",[t._v("Coroutine")]),t._v(". In JavaScript, the implementation of "),s("code",[t._v("Coroutine")]),t._v(" is "),s("code",[t._v("Generator")]),t._v(".")]),t._v(" "),s("p",[t._v("Now, we could think both of "),s("code",[t._v("Fiber")]),t._v(" and "),s("code",[t._v("Generator")]),t._v(" as an implemetation of the Algebraic Effects in JS.")]),t._v(" "),s("p",[s("code",[t._v("React")]),t._v(" has its own state update mechanism, which support task with different priority, could pause and resume and could resumes from where it left off. In fact, each updated task unit is the "),s("code",[t._v("Fiber")]),t._v(" of the "),s("code",[t._v("React Element")]),t._v(".")]),t._v(" "),s("p",[t._v("We will talk about how "),s("code",[t._v("Fiber")]),t._v(" implement in the next section.")])])}),[],!1,null,null,null);e.default=n.exports}}]);